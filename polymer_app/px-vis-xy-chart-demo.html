<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="import" href="./bower_components/polymer/polymer.html"/>
    <script src=".\bower_components\webcomponentsjs\webcomponents-lite.min.js"></script>
    <link rel="import" href=".\bower_components\px-data-table\px-data-table.html"></link>
    <link rel="import" href=".\bower_components\iron-ajax\iron-ajax.html"></link>
    <link rel="import" href=".\bower_components\px-icon-set\px-icon-set.html"></link>
    <link rel="import" href=".\bower_components\px-modal\px-modal.html"/>
    <link rel="import" href=".\bower_components\px-vis-xy-chart\px-vis-xy-chart.html"/>
    <link rel="import" href=".\bower_components\px-dropdown\px-dropdown.html"/>
    <link rel="import" href=".\bower_components\px-theme\px-theme-styles.html">
    <script src=".\bower_components\html2canvas\build\html2canvas.js"></script>
    <script src=".\bower_components\jspdf\dist\jspdf.debug.js"></script>
    <!--<script src=".\bower_components\html2canvas\build\html2canvas.min.js"></script>-->
      
</head>
<body>
    <dom-module id="px-vis-xy-chart-demo">
        <template>
            <style include="px-theme-styles" is="custom-style"></style>
            <style is="custom-style">
                body {
                    background-color: white;
                }
            </style>
            <px-dropdown 
                items='[{"key":"PDF","val":"Save as PDF"},{"key":"Image","val":"Save as Image (JPEG/PNG..)"}]'
                sort-mode="key"
                button-style="icon"
                icon="px-utl:save"
                disableClear
                trigger-height="30">
            </px-dropdown>
            <!--<px-vis-xy-chart
                debounce-resize-timing="250"
                width="590"
                height="335"
                chart-horizontal-alignment="center"
                chart-vertical-alignment="center"
                margin='{"top":30,"bottom":60,"left":75,"right":20}'
                tooltip-config='{"forceDateTimeDisplay":true}'
                register-config='{"type":"horizontal","forceDateTimeDisplay":true}'
                selection-type="xy"
                chart-data="[[chartData]]"
                series-config='{"firstSerie":{"type":"scatter","name":"Serie1","xAxisUnit":"AUD","yAxisUnit":"AUD","x":"BTC","y":"EUR","axis":{"id":"axis1","number":1,"side":"left"}},"secondSerie":{"type":"line","name":"Serie2","x":"EUR","y":"HKD","axis":{"id":"axis2","number":2,"side":"left"}},"thirdSerie":{"type":"scatter","name":"Serie3","xAxisUnit":"AUD","yAxisUnit":"AUD","x":"BTC","y":"HKD","axis":{"id":"axis1","number":1,"side":"left"}}}'
                chart-extents='{"x":["dynamic","dynamic"],"y":["dynamic","dynamic"]}'
                x-axis-config='{"title":"X","labelPosition":"center","orientation":"bottom"}'
                y-axis-config='{"title":"Y","labelPosition":"center","orientation":"left"}'
                time-data="Date"
                dynamic-menu-config='[{"name":"Delete","eventName":"delete","icon":"px-vis:trash-series"},{"name":"Bring To Front","eventName":"bring-to-front","icon":"px-vis:bring-to-front"}]'
                toolbar-config='{"config":{"advancedZoom":true,"pan":true,"tooltip":true,"logHover":{"buttonGroup":2,"tooltipLabel":"The submenu item of this menu will define custom mouse interaction","icon":"px-nav:notification","subConfig":{"customClick":{"icon":"px-nav:play","buttonGroup":3,"tooltipLabel":"define some custom mouse interactions on chart","eventName":"my-custom-click","actionConfig":{"mousedown":"function(mousePos) { console.log(\"custom click on chart. Context is the chart. Mouse pos is available: \" + JSON.stringify(mousePos))}","mouseup":"function(mousePos) { console.log(\"custom action on mouse up the chart \" + JSON.stringify(mousePos));}","mouseout":"function(mousePos) { console.log(\"custom action on mouse out the chart \" + JSON.stringify(mousePos));}","mousemove":"function(mousePos) { console.log(\"custom action on hovering the chart \");}"}},"customClick2":{"buttonGroup":3,"icon":"px-nav:pause","tooltipLabel":"Remove all custom interactions","actionConfig":{"mousedown":null,"mouseup":null,"mouseout":null,"mousemove":null}}}}}}'
                nav-height="100"
                nav-margin='{"top":5,"right":10,"bottom":20,"left":10}'
                nav-series-config='{"BTC":{"type":"line","name":"Trend","x":"Date","y":"BTC"}}'>
            </px-vis-xy-chart>-->
            <iron-ajax
                auto
                url="demo_data.json"
                params='{}'
                handle-as="json"
                on-response = "_handleResponse"
                debounce-duration="300">
            </iron-ajax>
            <div id="capture">
            <px-vis-xy-chart id="mychart"
                debounce-resize-timing="250"
                width="590.015625"
                height="334"
                chart-horizontal-alignment="center"
                chart-vertical-alignment="center"
                margin='{"top":30,"bottom":60,"left":75,"right":20}'
                tooltip-config='{"forceDateTimeDisplay":true}'
                register-config='{"type":"horizontal","forceDateTimeDisplay":true}'
                selection-type="xy"
                chart-data="{{data}}"
                series-config='{"firstSerie":{"type":"scatter","name":"Serie1","xAxisUnit":"Hz","yAxisUnit":"Hz","x":"T48A","y":"T48B","axis":{"id":"axis1","number":1,"side":"left"}},"secondSerie":{"type":"line","name":"Serie2","x":"T48A","y":"Line","axis":{"id":"axis2","number":2,"side":"left"}},"thirdSerie":{"type":"scatter","name":"Serie3","xAxisUnit":"Hz","yAxisUnit":"Hz","x":"T48A","y":"T48C","axis":{"id":"axis1","number":1,"side":"left"}}}'
                chart-extents='{"x":["dynamic","dynamic"],"y":["dynamic","dynamic"]}'
                event-data='[{"id":"123","label":"Fa Icon","x":"1334"},{"id":"456","label":"Unicode","x":"1342"},{"id":"789","label":"Default","x":"1346"}]'
                event-config='{"Fa Icon":{"color":"blue","icon":"px-fea:deployments","type":"px","offset":[0,0]},"Unicode":{"color":"green","icon":"px-fea:bug","type":"px","offset":[1,0]},"Event Png":{"icon":"ge_logo.png","type":"image","offset":[0,-20],"size":"20"}}'
                x-axis-config='{"title":"X","labelPosition":"center","orientation":"bottom"}'
                y-axis-config='{"title":"Y","labelPosition":"center","orientation":"left"}'
                time-data="Date"
                dynamic-menu-config='[{"name":"Delete","eventName":"delete","icon":"px-vis:trash-series"},{"name":"Bring To Front","eventName":"bring-to-front","icon":"px-vis:bring-to-front"}]'
                toolbar-config='{"config":{"advancedZoom":true,"pan":true,"tooltip":true,"logHover":{"buttonGroup":2,"tooltipLabel":"The submenu item of this menu will define custom mouse interaction","icon":"px-nav:notification","subConfig":{"customClick":{"icon":"px-nav:play","buttonGroup":3,"tooltipLabel":"define some custom mouse interactions on chart","eventName":"my-custom-click","actionConfig":{"mousedown":"function(mousePos) { console.log(\"custom click on chart. Context is the chart. Mouse pos is available: \" + JSON.stringify(mousePos))}","mouseup":"function(mousePos) { console.log(\"custom action on mouse up the chart \" + JSON.stringify(mousePos));}","mouseout":"function(mousePos) { console.log(\"custom action on mouse out the chart \" + JSON.stringify(mousePos));}","mousemove":"function(mousePos) { console.log(\"custom action on hovering the chart \");}"}},"customClick2":{"buttonGroup":3,"icon":"px-nav:pause","tooltipLabel":"Remove all custom interactions","actionConfig":{"mousedown":null,"mouseup":null,"mouseout":null,"mousemove":null}}}}}}'
                nav-height="100"
                nav-margin='{"top":5,"right":10,"bottom":20,"left":10}'
                nav-series-config='{"T48A":{"type":"line","name":"Trend","x":"Date","y":"T48A"}}'>
            </px-vis-xy-chart>
            </div>
        </template>
    </dom-module>
    
    <script>
        Polymer({
            is:"px-vis-xy-chart-demo",
            properties:{
                data:{
                    type:Array,
                    reflectToAttribute:true,
                    norify:true
                }
            },
            listeners: {
                "px-dropdown-selection-changed": "_save_as"
            },
            _handleResponse: function(event, request) {
                var response = request.response;
                this.data = response;
            },
            _save_as: function(event){
                var selected = this.$$("px-dropdown").selected;
                if(selected != null){
                    html2canvas(document.querySelector("#capture"), {
                        allowTaint: false,
                        background :'#FFFFFF',
                        onrendered: function(canvas) {
                            var a = document.createElement('a');        
                            var imgData = canvas.toDataURL(
                                'image/jpeg');
                            if(selected=="Image"){
                                a.href = imgData.replace("image/jpeg", "image/octet-stream");
                                a.download = 'capture.jpg';
                                a.click();
                            }
                            else if(selected =="PDF"){              
                                var doc = new jsPDF('p', 'mm');
                                var width = canvas.width;
                                var height = canvas.clientHeight;
                                doc.addImage(imgData, 'PNG', 15, 40,180, 160);
                                //doc.addImage(imgData, 'PNG',0,0)//, 50, 50);
                                //debugger;
                                doc.save('chart.pdf');
                            }
                        }
                    });
                }
            }  
        });
    </script>
</body>
</html>

<!--
<px-vis-xy-chart
debounce-resize-timing="250"
width="590.015625"
height="334"
chart-horizontal-alignment="center"
chart-vertical-alignment="center"
margin='{"top":30,"bottom":60,"left":75,"right":20}'
tooltip-config='{"forceDateTimeDisplay":true}'
register-config='{"type":"horizontal","forceDateTimeDisplay":true}'
selection-type="xy"
chart-data="[[chartData]]"
series-config='{"firstSerie":{"type":"scatter","name":"Serie1","xAxisUnit":"Hz","yAxisUnit":"Hz","x":"T48A","y":"T48B","axis":{"id":"axis1","number":1,"side":"left"}},"secondSerie":{"type":"line","name":"Serie2","x":"T48A","y":"Line","axis":{"id":"axis2","number":2,"side":"left"}},"thirdSerie":{"type":"scatter","name":"Serie3","xAxisUnit":"Hz","yAxisUnit":"Hz","x":"T48A","y":"T48C","axis":{"id":"axis1","number":1,"side":"left"}}}'
chart-extents='{"x":["dynamic","dynamic"],"y":["dynamic","dynamic"]}'
event-data='[{"id":"123","label":"Fa Icon","x":"1334"},{"id":"456","label":"Unicode","x":"1342"},{"id":"789","label":"Default","x":"1346"}]'
event-config='{"Fa Icon":{"color":"blue","icon":"px-fea:deployments","type":"px","offset":[0,0]},"Unicode":{"color":"green","icon":"px-fea:bug","type":"px","offset":[1,0]},"Event Png":{"icon":"ge_logo.png","type":"image","offset":[0,-20],"size":"20"}}'
x-axis-config='{"title":"X","labelPosition":"center","orientation":"bottom"}'
y-axis-config='{"title":"Y","labelPosition":"center","orientation":"left"}'
time-data="Date"
dynamic-menu-config='[{"name":"Delete","eventName":"delete","icon":"px-vis:trash-series"},{"name":"Bring To Front","eventName":"bring-to-front","icon":"px-vis:bring-to-front"}]'
toolbar-config='{"config":{"advancedZoom":true,"pan":true,"tooltip":true,"logHover":{"buttonGroup":2,"tooltipLabel":"The submenu item of this menu will define custom mouse interaction","icon":"px-nav:notification","subConfig":{"customClick":{"icon":"px-nav:play","buttonGroup":3,"tooltipLabel":"define some custom mouse interactions on chart","eventName":"my-custom-click","actionConfig":{"mousedown":"function(mousePos) { console.log(\"custom click on chart. Context is the chart. Mouse pos is available: \" + JSON.stringify(mousePos))}","mouseup":"function(mousePos) { console.log(\"custom action on mouse up the chart \" + JSON.stringify(mousePos));}","mouseout":"function(mousePos) { console.log(\"custom action on mouse out the chart \" + JSON.stringify(mousePos));}","mousemove":"function(mousePos) { console.log(\"custom action on hovering the chart \");}"}},"customClick2":{"buttonGroup":3,"icon":"px-nav:pause","tooltipLabel":"Remove all custom interactions","actionConfig":{"mousedown":null,"mouseup":null,"mouseout":null,"mousemove":null}}}}}}'
nav-height="100"
nav-margin='{"top":5,"right":10,"bottom":20,"left":10}'
nav-series-config='{"T48A":{"type":"line","name":"Trend","x":"Date","y":"T48A"}}'>
</px-vis-xy-chart> 

value : "[\
        { \"CountryName\": \"China\", \"Pop1995\": 1216, \"Pop2005\": 1297, \"Pop2015\": 1361, \"Pop2025\": 1394 },\
        { \"CountryName\": \"India\", \"Pop1995\": 920, \"Pop2005\": 1090, \"Pop2015\": 1251, \"Pop2025\": 1396 },\
        { \"CountryName\": \"United States\", \"Pop1995\": 266, \"Pop2005\": 295, \"Pop2015\": 322, \"Pop2025\": 351 },\
        { \"CountryName\": \"Indonesia\", \"Pop1995\": 197, \"Pop2005\": 229, \"Pop2015\": 256, \"Pop2025\": 277 },\
        {\"CountryName\": \"Brazil\", \"Pop1995\": 161, \"Pop2005\": 186, \"Pop2015\": 204, \"Pop2025\": 218 }\
        ]"
    
    value: "[\
                    {\"Date\":\"2013-01-01\"\
                        \"BTC\": 0.0778595876,\
                        \"EUR\": 0.785518,\
                        \"HKD\": 8.04136\
                    },\
                    {\"Date\":\"2013-01-02\"\
                        \"BTC\": 0.0789400739,\
                        \"EUR\": 0.795034,\
                        \"HKD\": 8.138096\
                    },\
                    {\"Date\":\"2013-01-03\"\
                        \"BTC\": 0.0785299961,\
                        \"EUR\": 0.80092,\
                        \"HKD\": 8.116954\
                    },\
                    {\"Date\":\"2013-01-04\"\
                        \"BTC\": 0.0778595876,\
                        \"EUR\": 0.785518,\
                        \"HKD\": 8.04136\
                    },\
                    {\"Date\":\"2013-01-05\"\
                        \"BTC\": 0.0789400739,\
                        \"EUR\": 0.795034,\
                        \"HKD\": 8.138096\
                    },\
                    {\"Date\":\"2013-01-06\"\
                        \"BTC\": 0.0785299961,\
                        \"EUR\": 0.80092,\
                        \"HKD\": 8.116954\
                    },\
                    {\"Date\":\"2013-01-07\"\
                        \"BTC\": 0.0778595876,\
                        \"EUR\": 0.785518,\
                        \"HKD\": 8.04136\
                    },\
                    {\"Date\":\"2013-01-08\"\
                        \"BTC\": 0.0789400739,\
                        \"EUR\": 0.795034,\
                        \"HKD\": 8.138096\
                    },\
                    {\"Date\":\"2013-01-09\"\
                        \"BTC\": 0.0785299961,\
                        \"EUR\": 0.80092,\
                        \"HKD\": 8.116954\
                    },\
                    {\"Date\":\"2013-01-10\"\
                        \"BTC\": 0.0785299961,\
                        \"EUR\": 0.80092,\
                        \"HKD\": 8.116954\
                    }\
                    ]"
    
    -->

